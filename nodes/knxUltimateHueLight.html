<script type="text/javascript">
    RED.nodes.registerType('knxUltimateHueLight', {
        category: "KNX Ultimate",
        color: '#C7E9C0',
        defaults: {
            //buttonState: {value: true},
            server: { type: "knxUltimate-config", required: true },
            serverHue: { type: "hue-config", required: true },
            name: { value: "" },

            nameLightSwitch: { value: "" },
            GALightSwitch: { value: "" },
            dptLightSwitch: { value: "" },

            nameLightState: { value: "" },
            GALightState: { value: "" },
            dptLightState: { value: "" },

            nameLightDIM: { value: "" },
            GALightDIM: { value: "" },
            dptLightDIM: { value: "" },

            nameLightColor: { value: "" },
            GALightColor: { value: "" },
            dptLightColor: { value: "" },

            nameLightColorState: { value: "" },
            GALightColorState: { value: "" },
            dptLightColorState: { value: "" },

            nameLightHSV: { value: "" },
            GALightHSV: { value: "" },
            dptLightHSV: { value: "" },

            nameLightHSVState: { value: "" },
            GALightHSVState: { value: "" },
            dptLightHSVState: { value: "" },

            nameLightBrightness: { value: "" },
            GALightBrightness: { value: "" },
            dptLightBrightness: { value: "" },

            nameLightBrightnessState: { value: "" },
            GALightBrightnessState: { value: "" },
            dptLightBrightnessState: { value: "" },

            nameLightBlink: { value: "" },
            GALightBlink: { value: "" },
            dptLightBlink: { value: "" },

            nameLightColorCycle: { value: "" },
            GALightColorCycle: { value: "" },
            dptLightColorCycle: { value: "" },

            colorAtSwitchOnDayTime: { value: '{"red":255, "green":255, "blue":255}' },
            colorAtSwitchOnNightTime: { value: '{"red":23, "green":4, "blue":0}' },

            nameDaylightSensor: { value: "" },
            GADaylightSensor: { value: "" },
            dptDaylightSensor: { value: "" },

            hueDevice: { value: "" }
        },
        inputs: 0,
        outputs: 0,
        icon: "node-hue-icon.svg",
        label: function () {
            return (this.name);
        },
        paletteLabel: "Hue Light",
        // button: {
        //     enabled: function() {
        //         // return whether or not the button is enabled, based on the current
        //         // configuration of the node
        //         return !this.changed
        //     },
        //     visible: function() {
        //         // return whether or not the button is visible, based on the current
        //         // configuration of the node
        //         return this.hasButton
        //     },
        //     //toggle: "buttonState",
        //     onclick: function() {}
        // },
        oneditprepare: function () {
            var node = this;
            var oNodeServer = RED.nodes.node($("#node-input-server").val()); // Store the config-node
            var oNodeServerHue = RED.nodes.node($("#node-input-serverHue").val()); // Store the config-node

            $("#tabs").tabs();

            // 19/02/2020 Used to get the server sooner als deploy.
            $("#node-input-server").change(function () {
                try {
                    oNodeServer = RED.nodes.node($(this).val());
                } catch (error) { }
            });
            // 19/02/2020 Used to get the server sooner als deploy.
            $("#node-input-serverHue").change(function () {
                try {
                    oNodeServerHue = RED.nodes.node($(this).val());
                } catch (error) { }
            });

            // 31/03/2020 Search Helper
            function fullSearch(sourceText, searchString) {
                // This searches for all words in a string
                var aSearchWords = searchString.toLowerCase().split(" ");
                var i = 0;
                for (let index = 0; index < aSearchWords.length; index++) {
                    if (sourceText.toLowerCase().indexOf(aSearchWords[index]) > -1) i += 1;
                }
                return i == aSearchWords.length;
            }

            // DPT Switch command
            // ########################
            $.getJSON('knxUltimateDpts', (data) => {
                data.forEach(dpt => {
                    if (dpt.value.startsWith("1.")) {
                        $("#node-input-dptLightSwitch").append($("<option></option>")
                            .attr("value", dpt.value)
                            .text(dpt.text))
                    }
                });
                $("#node-input-dptLightSwitch").val(this.dptLightSwitch)
            })

            // Autocomplete suggestion with ETS csv File
            $("#node-input-GALightSwitch").autocomplete({
                minLength: 1,
                source: function (request, response) {
                    //$.getJSON("csv", request, function( data, status, xhr ) {
                    $.getJSON("knxUltimatecsv?nodeID=" + oNodeServer.id, (data) => {
                        response($.map(data, function (value, key) {
                            var sSearch = (value.ga + " (" + value.devicename + ") DPT" + value.dpt);
                            if (fullSearch(sSearch, request.term + " 1.")) {
                                return {
                                    label: value.ga + " # " + value.devicename + " # " + value.dpt, // Label for Display
                                    value: value.ga // Value
                                }
                            } else {
                                return null;
                            }
                        }));
                    });
                }, select: function (event, ui) {
                    // Sets Datapoint and device name automatically
                    var sDevName = ui.item.label.split("#")[1].trim();
                    try {
                        sDevName = sDevName.substr(sDevName.indexOf(")") + 1).trim();
                    } catch (error) {
                    }
                    $('#node-input-nameLightSwitch').val(sDevName);
                    var optVal = $("#node-input-dptLightSwitch option:contains('" + ui.item.label.split("#")[2].trim() + "')").attr('value');
                    // Select the option value 
                    $("#node-input-dptLightSwitch").val(optVal);
                }
            });
            // ######################## 



            // DPT State
            // ########################
            $.getJSON('knxUltimateDpts', (data) => {
                data.forEach(dpt => {
                    if (dpt.value.startsWith("1.")) {
                        $("#node-input-dptLightState").append($("<option></option>")
                            .attr("value", dpt.value)
                            .text(dpt.text))
                    }
                });

                $("#node-input-dptLightState").val(this.dptLightState)
            })

            // Autocomplete suggestion with ETS csv File
            $("#node-input-GALightState").autocomplete({
                minLength: 1,
                source: function (request, response) {
                    $.getJSON("knxUltimatecsv?nodeID=" + oNodeServer.id, (data) => {
                        response($.map(data, function (value, key) {
                            var sSearch = (value.ga + " (" + value.devicename + ") DPT" + value.dpt);
                            if (fullSearch(sSearch, request.term + " 1.")) {
                                return {
                                    label: value.ga + " # " + value.devicename + " # " + value.dpt, // Label for Display
                                    value: value.ga // Value
                                }
                            } else {
                                return null;
                            }
                        }));
                    });
                }, select: function (event, ui) {
                    // Sets Datapoint and device name automatically
                    var sDevName = ui.item.label.split("#")[1].trim();
                    try {
                        sDevName = sDevName.substr(sDevName.indexOf(")") + 1).trim();
                    } catch (error) {
                    }
                    $('#node-input-nameLightState').val(sDevName);
                    var optVal = $("#node-input-dptLightState option:contains('" + ui.item.label.split("#")[2].trim() + "')").attr('value');
                    // Select the option value 
                    $("#node-input-dptLightState").val(optVal);
                }
            });


            // DPT dptLightDIM
            // ########################
            $.getJSON('knxUltimateDpts', (data) => {
                data.forEach(dpt => {
                    if (dpt.value === "3.007") {
                        $("#node-input-dptLightDIM").append($("<option></option>")
                            .attr("value", dpt.value)
                            .text(dpt.text))
                    }
                });

                $("#node-input-dptLightDIM").val(this.dptLightDIM)

            })

            // Autocomplete suggestion with ETS csv File
            $("#node-input-GALightDIM").autocomplete({
                minLength: 1,
                source: function (request, response) {
                    $.getJSON("knxUltimatecsv?nodeID=" + oNodeServer.id, (data) => {
                        response($.map(data, function (value, key) {
                            var sSearch = (value.ga + " (" + value.devicename + ") DPT" + value.dpt);
                            if (fullSearch(sSearch, request.term + " 3.007")) {
                                return {
                                    label: value.ga + " # " + value.devicename + " # " + value.dpt, // Label for Display
                                    value: value.ga // Value
                                }
                            } else {
                                return null;
                            }
                        }));
                    });
                }, select: function (event, ui) {
                    // Sets Datapoint and device name automatically
                    var sDevName = ui.item.label.split("#")[1].trim();
                    try {
                        sDevName = sDevName.substr(sDevName.indexOf(")") + 1).trim();
                    } catch (error) {
                    }
                    $('#node-input-nameLightDIM').val(sDevName);
                    var optVal = $("#node-input-dptLightDIM option:contains('" + ui.item.label.split("#")[2].trim() + "')").attr('value');
                    // Select the option value 
                    $("#node-input-dptLightDIM").val(optVal);
                }
            });


            // DPT dptLightColor and dptLightColorState
            // ########################
            $.getJSON('knxUltimateDpts', (data) => {
                data.forEach(dpt => {
                    if (dpt.value === "232.600") {
                        $("#node-input-dptLightColor").append($("<option></option>")
                            .attr("value", dpt.value)
                            .text(dpt.text))
                        $("#node-input-dptLightColorState").append($("<option></option>")
                            .attr("value", dpt.value)
                            .text(dpt.text))
                    }
                });

                $("#node-input-dptLightColor").val(this.dptLightColor)
                $("#node-input-dptLightColorState").val(this.dptLightColorState)

            })

            // Autocomplete suggestion with ETS csv File
            $("#node-input-GALightColor").autocomplete({
                minLength: 1,
                source: function (request, response) {
                    $.getJSON("knxUltimatecsv?nodeID=" + oNodeServer.id, (data) => {
                        response($.map(data, function (value, key) {
                            var sSearch = (value.ga + " (" + value.devicename + ") DPT" + value.dpt);
                            if (fullSearch(sSearch, request.term + " 232.600")) {
                                return {
                                    label: value.ga + " # " + value.devicename + " # " + value.dpt, // Label for Display
                                    value: value.ga // Value
                                }
                            } else {
                                return null;
                            }
                        }));
                    });
                }, select: function (event, ui) {
                    // Sets Datapoint and device name automatically
                    var sDevName = ui.item.label.split("#")[1].trim();
                    try {
                        sDevName = sDevName.substr(sDevName.indexOf(")") + 1).trim();
                    } catch (error) {
                    }
                    $('#node-input-nameLightColor').val(sDevName);
                    var optVal = $("#node-input-dptLightColor option:contains('" + ui.item.label.split("#")[2].trim() + "')").attr('value');
                    // Select the option value 
                    $("#node-input-dptLightColor").val(optVal);
                }
            });

            // Autocomplete suggestion with ETS csv File
            $("#node-input-GALightColorState").autocomplete({
                minLength: 1,
                source: function (request, response) {
                    $.getJSON("knxUltimatecsv?nodeID=" + oNodeServer.id, (data) => {
                        response($.map(data, function (value, key) {
                            var sSearch = (value.ga + " (" + value.devicename + ") DPT" + value.dpt);
                            if (fullSearch(sSearch, request.term + " 232.600")) {
                                return {
                                    label: value.ga + " # " + value.devicename + " # " + value.dpt, // Label for Display
                                    value: value.ga // Value
                                }
                            } else {
                                return null;
                            }
                        }));
                    });
                }, select: function (event, ui) {
                    // Sets Datapoint and device name automatically
                    var sDevName = ui.item.label.split("#")[1].trim();
                    try {
                        sDevName = sDevName.substr(sDevName.indexOf(")") + 1).trim();
                    } catch (error) {
                    }
                    $('#node-input-nameLightColorState').val(sDevName);
                    var optVal = $("#node-input-dptLightColorState option:contains('" + ui.item.label.split("#")[2].trim() + "')").attr('value');
                    // Select the option value 
                    $("#node-input-dptLightColorState").val(optVal);
                }
            });






            // DPT dptLightTunableWhite 
            // ########################
            $.getJSON('knxUltimateDpts', (data) => {
                data.forEach(dpt => {
                    if (dpt.value === "3.007") {
                        $("#node-input-dptLightHSV").append($("<option></option>")
                            .attr("value", dpt.value)
                            .text(dpt.text))
                    }
                });

                $("#node-input-dptLightHSV").val(this.dptLightHSV)
            })

            // DPT  dptLightTunableWhiteState
            $.getJSON('knxUltimateDpts', (data) => {
                data.forEach(dpt => {
                    if (dpt.value === "5.001") {
                        $("#node-input-dptLightHSVState").append($("<option></option>")
                            .attr("value", dpt.value)
                            .text(dpt.text))
                    }
                });
                $("#node-input-dptLightHSVState").val(this.dptLightHSVState)
            })

            // Autocomplete suggestion with ETS csv File
            $("#node-input-GALightHSV").autocomplete({
                minLength: 1,
                source: function (request, response) {
                    $.getJSON("knxUltimatecsv?nodeID=" + oNodeServer.id, (data) => {
                        response($.map(data, function (value, key) {
                            if (value.dpt === "3.007") {
                                var sSearch = (value.ga + " (" + value.devicename + ") DPT" + value.dpt);
                                if (fullSearch(sSearch, request.term)) {
                                    return {
                                        label: value.ga + " # " + value.devicename + " # " + value.dpt, // Label for Display
                                        value: value.ga // Value
                                    }
                                } else {
                                    return null;
                                }
                            }
                        }));
                    });
                }, select: function (event, ui) {
                    // Sets Datapoint and device name automatically
                    var sDevName = ui.item.label.split("#")[1].trim();
                    try {
                        sDevName = sDevName.substr(sDevName.indexOf(")") + 1).trim();
                    } catch (error) {
                    }
                    $('#node-input-nameLightHSV').val(sDevName);
                    var optVal = $("#node-input-dptLightHSV option:contains('" + ui.item.label.split("#")[2].trim() + "')").attr('value');
                    // Select the option value 
                    $("#node-input-dptLightHSV").val(optVal);
                }
            });

            // Autocomplete suggestion with ETS csv File
            $("#node-input-GALightHSVState").autocomplete({
                minLength: 1,
                source: function (request, response) {
                    $.getJSON("knxUltimatecsv?nodeID=" + oNodeServer.id, (data) => {
                        response($.map(data, function (value, key) {
                            if (value.dpt === "5.001") {
                                var sSearch = (value.ga + " (" + value.devicename + ") DPT" + value.dpt);
                                if (fullSearch(sSearch, request.term)) {
                                    return {
                                        label: value.ga + " # " + value.devicename + " # " + value.dpt, // Label for Display
                                        value: value.ga // Value
                                    }
                                } else {
                                    return null;
                                }
                            }
                        }));
                    });
                }, select: function (event, ui) {
                    // Sets Datapoint and device name automatically
                    var sDevName = ui.item.label.split("#")[1].trim();
                    try {
                        sDevName = sDevName.substr(sDevName.indexOf(")") + 1).trim();
                    } catch (error) {
                    }
                    $('#node-input-nameLightHSVState').val(sDevName);
                    var optVal = $("#node-input-dptLightHSVState option:contains('" + ui.item.label.split("#")[2].trim() + "')").attr('value');
                    // Select the option value 
                    $("#node-input-dptLightHSVState").val(optVal);
                }
            });
            // ########################




            // DPT dptLightBrightness and dptLightBrightnessState
            // ########################
            $.getJSON('knxUltimateDpts', (data) => {
                data.forEach(dpt => {
                    if (dpt.value === "5.001") {
                        $("#node-input-dptLightBrightness").append($("<option></option>")
                            .attr("value", dpt.value)
                            .text(dpt.text))
                        $("#node-input-dptLightBrightnessState").append($("<option></option>")
                            .attr("value", dpt.value)
                            .text(dpt.text))
                    }
                });

                $("#node-input-dptLightBrightness").val(this.dptLightBrightness)
                $("#node-input-dptLightBrightnessState").val(this.dptLightBrightnessState)

            })

            // Autocomplete suggestion with ETS csv File
            $("#node-input-GALightBrightness").autocomplete({
                minLength: 1,
                source: function (request, response) {
                    $.getJSON("knxUltimatecsv?nodeID=" + oNodeServer.id, (data) => {
                        response($.map(data, function (value, key) {
                            var sSearch = (value.ga + " (" + value.devicename + ") DPT" + value.dpt);
                            if (fullSearch(sSearch, request.term + " 5.001")) {
                                return {
                                    label: value.ga + " # " + value.devicename + " # " + value.dpt, // Label for Display
                                    value: value.ga // Value
                                }
                            } else {
                                return null;
                            }
                        }));
                    });
                }, select: function (event, ui) {
                    // Sets Datapoint and device name automatically
                    var sDevName = ui.item.label.split("#")[1].trim();
                    try {
                        sDevName = sDevName.substr(sDevName.indexOf(")") + 1).trim();
                    } catch (error) {
                    }
                    $('#node-input-nameLightBrightness').val(sDevName);
                    var optVal = $("#node-input-dptLightBrightness option:contains('" + ui.item.label.split("#")[2].trim() + "')").attr('value');
                    // Select the option value 
                    $("#node-input-dptLightBrightness").val(optVal);
                }
            });

            // Autocomplete suggestion with ETS csv File
            $("#node-input-GALightBrightnessState").autocomplete({
                minLength: 1,
                source: function (request, response) {
                    $.getJSON("knxUltimatecsv?nodeID=" + oNodeServer.id, (data) => {
                        response($.map(data, function (value, key) {
                            var sSearch = (value.ga + " (" + value.devicename + ") DPT" + value.dpt);
                            if (fullSearch(sSearch, request.term + " 5.001")) {
                                return {
                                    label: value.ga + " # " + value.devicename + " # " + value.dpt, // Label for Display
                                    value: value.ga // Value
                                }
                            } else {
                                return null;
                            }
                        }));
                    });
                }, select: function (event, ui) {
                    // Sets Datapoint and device name automatically
                    var sDevName = ui.item.label.split("#")[1].trim();
                    try {
                        sDevName = sDevName.substr(sDevName.indexOf(")") + 1).trim();
                    } catch (error) {
                    }
                    $('#node-input-nameLightBrightnessState').val(sDevName);
                    var optVal = $("#node-input-dptLightBrightnessState option:contains('" + ui.item.label.split("#")[2].trim() + "')").attr('value');
                    // Select the option value 
                    $("#node-input-dptLightBrightnessState").val(optVal);
                }
            });



            // DPT Blink command
            // ########################
            $.getJSON('knxUltimateDpts', (data) => {
                data.forEach(dpt => {
                    if (dpt.value.startsWith("1.")) {
                        $("#node-input-dptLightBlink").append($("<option></option>")
                            .attr("value", dpt.value)
                            .text(dpt.text))
                    }
                });
                $("#node-input-dptLightBlink").val(this.dptLightSwitch)
            })

            // Autocomplete suggestion with ETS csv File
            $("#node-input-GALightBlink").autocomplete({
                minLength: 1,
                source: function (request, response) {
                    //$.getJSON("csv", request, function( data, status, xhr ) {
                    $.getJSON("knxUltimatecsv?nodeID=" + oNodeServer.id, (data) => {
                        response($.map(data, function (value, key) {
                            var sSearch = (value.ga + " (" + value.devicename + ") DPT" + value.dpt);
                            if (fullSearch(sSearch, request.term + " 1.")) {
                                return {
                                    label: value.ga + " # " + value.devicename + " # " + value.dpt, // Label for Display
                                    value: value.ga // Value
                                }
                            } else {
                                return null;
                            }
                        }));
                    });
                }, select: function (event, ui) {
                    // Sets Datapoint and device name automatically
                    var sDevName = ui.item.label.split("#")[1].trim();
                    try {
                        sDevName = sDevName.substr(sDevName.indexOf(")") + 1).trim();
                    } catch (error) {
                    }
                    $('#node-input-nameLightBlink').val(sDevName);
                    var optVal = $("#node-input-dptLightBlink option:contains('" + ui.item.label.split("#")[2].trim() + "')").attr('value');
                    // Select the option value 
                    $("#node-input-dptLightBlink").val(optVal);
                }
            });
            // ########################



            // DPT Cycle Colors
            // ########################
            $.getJSON('knxUltimateDpts', (data) => {
                data.forEach(dpt => {
                    if (dpt.value.startsWith("1.")) {
                        $("#node-input-dptLightColorCycle").append($("<option></option>")
                            .attr("value", dpt.value)
                            .text(dpt.text))
                    }
                });
                $("#node-input-dptLightColorCycle").val(this.dptLightColorCycle)
            })

            // Autocomplete suggestion with ETS csv File
            $("#node-input-GALightColorCycle").autocomplete({
                minLength: 1,
                source: function (request, response) {
                    //$.getJSON("csv", request, function( data, status, xhr ) {
                    $.getJSON("knxUltimatecsv?nodeID=" + oNodeServer.id, (data) => {
                        response($.map(data, function (value, key) {
                            var sSearch = (value.ga + " (" + value.devicename + ") DPT" + value.dpt);
                            if (fullSearch(sSearch, request.term + " 1.")) {
                                return {
                                    label: value.ga + " # " + value.devicename + " # " + value.dpt, // Label for Display
                                    value: value.ga // Value
                                }
                            } else {
                                return null;
                            }
                        }));
                    });
                }, select: function (event, ui) {
                    // Sets Datapoint and device name automatically
                    var sDevName = ui.item.label.split("#")[1].trim();
                    try {
                        sDevName = sDevName.substr(sDevName.indexOf(")") + 1).trim();
                    } catch (error) {
                    }
                    $('#node-input-nameLightColorCycle').val(sDevName);
                    var optVal = $("#node-input-dptLightColorCycle option:contains('" + ui.item.label.split("#")[2].trim() + "')").attr('value');
                    // Select the option value 
                    $("#node-input-dptLightColorCycle").val(optVal);
                }
            });
            // ########################


            // DPT Day/Time sensor
            // ########################
            $.getJSON('knxUltimateDpts', (data) => {
                data.forEach(dpt => {
                    if (dpt.value.startsWith("1.")) {
                        $("#node-input-dptDaylightSensor").append($("<option></option>")
                            .attr("value", dpt.value)
                            .text(dpt.text))
                    }
                });
                $("#node-input-dptDaylightSensor").val(this.dptDaylightSensor)
            })

            // Autocomplete suggestion with ETS csv File
            $("#node-input-GADaylightSensor").autocomplete({
                minLength: 1,
                source: function (request, response) {
                    //$.getJSON("csv", request, function( data, status, xhr ) {
                    $.getJSON("knxUltimatecsv?nodeID=" + oNodeServer.id, (data) => {
                        response($.map(data, function (value, key) {
                            var sSearch = (value.ga + " (" + value.devicename + ") DPT" + value.dpt);
                            if (fullSearch(sSearch, request.term + " 1.")) {
                                return {
                                    label: value.ga + " # " + value.devicename + " # " + value.dpt, // Label for Display
                                    value: value.ga // Value
                                }
                            } else {
                                return null;
                            }
                        }));
                    });
                }, select: function (event, ui) {
                    // Sets Datapoint and device name automatically
                    var sDevName = ui.item.label.split("#")[1].trim();
                    try {
                        sDevName = sDevName.substr(sDevName.indexOf(")") + 1).trim();
                    } catch (error) {
                    }
                    $('#node-input-nameDaylightSensor').val(sDevName);
                    var optVal = $("#node-input-dptDaylightSensor option:contains('" + ui.item.label.split("#")[2].trim() + "')").attr('value');
                    // Select the option value 
                    $("#node-input-dptDaylightSensor").val(optVal);
                }
            });
            // ########################



            // Autocomplete suggestion with HUE Lights
            $("#node-input-name").autocomplete({
                minLength: 1,
                source: function (request, response) {
                    $.getJSON("KNXUltimateGetResourcesHUE?rtype=light&nodeID=" + oNodeServerHue.id, (data) => {
                        response($.map(data.devices, function (value, key) {
                            //alert(JSON.stringify(value) + " "+ key)
                            var sSearch = (value.name);
                            if (fullSearch(sSearch, request.term)) {
                                return {
                                    hueDevice: value.id, // Label for Display
                                    value: value.name // Value
                                }
                            } else {
                                return null;
                            }
                        }));
                    });
                }, select: function (event, ui) {
                    // Sets the fields
                    $('#node-input-hueDevice').val(ui.item.hueDevice);
                }
            });


            // ########################


        },
        oneditsave: function () {


        },
        oneditcancel: function () {

        }
    })

</script>
<script src="https://kit.fontawesome.com/11f26b4500.js" crossorigin="anonymous"></script>

<script type="text/html" data-template-name="knxUltimateHueLight">


<div class="form-row">
    <b>HUE Light node</b>&nbsp&nbsp<span style="color:red"
    &nbsp
    &nbsp<i class="fa fa-youtube"></i></span>&nbsp<a target="_blank" href="https://youtu.be/3M02Du2gero"><u>Youtube sample</u></a> 
    <br />
    <br />
    <p align="center">
       <i class="fa-regular fa-lightbulb fa-bounce fa-8x"></i>
    </p>
    <br />
    <label for="node-input-server" >
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAKnRFWHRDcmVhdGlvbiBUaW1lAEZyIDYgQXVnIDIwMTAgMjE6NTI6MTkgKzAxMDD84aS8AAAAB3RJTUUH3gYYCicNV+4WIQAAAAlwSFlzAAALEgAACxIB0t1+/AAAAARnQU1BAACxjwv8YQUAAACUSURBVHjaY2CgFZg5c+Z/ZEyWAZ8+f/6/ZsWs/xoamqMGkGrA6Wla/1+fVARjEBuGsSoGmY4eZSCNL59d/g8DIDbIAHR14OgFGQByKjIGKX5+6/T///8gGMQGiV1+/B0Fg70GIkD+RMYgxf/O5/7//2MSmAZhkBi6OrgB6Bg5DGB4ajr3f2xqsYYLSDE2THJUDg0AAAqyDVd4tp4YAAAAAElFTkSuQmCC"></img>
        KNX GW
    </label>
    <input type="text" id="node-input-server" />
</div>

<div class="form-row">
    <label for="node-input-serverHue">
        <img src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAEKADAAQAAAABAAAAEAAAAAA0VXHyAAABFUlEQVQ4EZWSsWoCQRCG1yiENEFEi6QSkjqWWoqFoBYJ+Br6JHkMn8Iibd4ihQpaJIhWNkry/ZtdGZY78Qa+m39nZ+dm9s4550awglNBluS/gVtAX6KgDclf68w2OThgfR9iT/jnoEv4TtByDThWTCDKW4SSZTf/zj9/eZbN+izTDuKGimu0vPF8B/YN8aC8LmcOj/AAn9CFTEs70Js/oGqy79C69bqJ5XbQI2kGO5N8QL9D08S8zBtBF5ZaVsznpCMoqJnVdjTpb1Db0fwIWmQV6BLXzFOYgA6/gDVfQN9bBWp2J2hdWDPoBV5FrKnAJutHikk/CHHR8i7x4iG7qQ720IYvu3GFbpHjx3pFrOFYkA354z/5bkK826phyAAAAABJRU5ErkJggg=="/>
        HUE Bridge
    </label>
    <input type="text" id="node-input-serverHue" />
</div>


<br/>
<p>
<b>Philips HUE</b>
</p>
    
<div class="form-row">
    <label for="node-input-hueDevice" >
        <i class="fa fa-play-circle"></i>&nbspName</label>
    <input type="text" id="node-input-name" placeholder="Enter your hue device name"/>
    <input type="hidden" id="node-input-hueDevice"/>
</div>

<br/>


<div id="tabs">
    <ul>
      <li><a href="#tabs-1">Switching</a></li>
      <li><a href="#tabs-2">Dimming/Brightness</a></li>
      <li><a href="#tabs-3">Tunable white</a></li>
      <li><a href="#tabs-4">Colors</a></li>
      <li><a href="#tabs-5">Effects</a></li>
    </ul>
    <div id="tabs-1">
      <p>        
        <div class="form-row">
            <label for="node-input-nameLightSwitch" style="width:100px;"><i class="fa fa-play-circle-o"></i> <span data-i18n="knxUltimateHueLight.node-input-nameLightSwitch"></span></label>

            <label for="node-input-GALightSwitch" style="width:20px;"><span data-i18n="knxUltimateHueLight.node-input-GALightSwitch"></span></label>
            <input type="text" id="node-input-GALightSwitch" placeholder="Ex: 1/1/1" style="width:70px;margin-left: 5px; text-align: left;">
        
            <label for="node-input-dptLightSwitch" style="width:40px; margin-left: 0px; text-align: right;">DPT</label>
            <select id="node-input-dptLightSwitch" style="width:140px;"></select>
        
            <label for="node-input-nameLightSwitch" style="width:50px; margin-left: 0px; text-align: right;"><span data-i18n="knxUltimateHueLight.node-input-name"></span></label>
            <input type="text" id="node-input-nameLightSwitch" style="width:200px;margin-left: 5px; text-align: left;">
        </div>
        <div class="form-row">
            <label for="node-input-nameLightState" style="width:100px;"><i class="fa fa-play-circle-o"></i> Switch Status</label>

            <label for="node-input-GALightState" style="width:20px;">GA</label>
            <input type="text" id="node-input-GALightState" placeholder="Ex: 1/1/1" style="width:70px;margin-left: 5px; text-align: left;">
        
            <label for="node-input-dptLightState" style="width:40px; margin-left: 0px; text-align: right;">DPT</label>
            <select id="node-input-dptLightState" style="width:140px;"></select>
        
            <label for="node-input-nameLightState" style="width:50px; margin-left: 0px; text-align: right;"><span data-i18n="knxUltimateHueLight.node-input-name"></span></label>
            <input type="text" id="node-input-nameLightState" style="width:200px;margin-left: 5px; text-align: left;">
        </div>
        
        <div class="form-row">
            <label for="node-input-nameDaylightSensor" style="width:100px;"><i class="fa fa-clock-o"></i> Day/Night</label>

            <label for="node-input-GADaylightSensor" style="width:20px;">GA</label>
            <input type="text" id="node-input-GADaylightSensor" placeholder="Ex: 1/1/1" style="width:70px;margin-left: 5px; text-align: left;">
        
            <label for="node-input-dptDaylightSensor" style="width:40px; margin-left: 0px; text-align: right;">DPT</label>
            <select id="node-input-dptDaylightSensor" style="width:140px;"></select>
        
            <label for="node-input-nameDaylightSensor" style="width:50px; margin-left: 0px; text-align: right;"><span data-i18n="knxUltimateHueLight.node-input-name"></span></label>
            <input type="text" id="node-input-nameDaylightSensor" style="width:200px;margin-left: 5px; text-align: left;">
        </div>

        <div class="form-row">
            <label for="node-input-colorAtSwitchOnDayTime" style="width:200px">
                <i class="fa fa-sun-o"></i> Switch on color at Daytime
            </label>
            <input type="text" id="node-input-colorAtSwitchOnDayTime" placeholder='{"red":255, "green":255, "blue":255}' style="width:250px">            
        </div>
        <div class="form-row">
            <label for="node-input-colorAtSwitchOnNightTime" style="width:200px">
                <i class="fa fa-moon-o"></i> Switch on color at Nighttime
            </label>
            <input type="text" id="node-input-colorAtSwitchOnNightTime" placeholder='{"red":100, "green":0, "blue":50}' style="width:250px">            
        </div>
        
      </p>
    </div>
    <div id="tabs-2">
      <p>
        <div class="form-row">
        <label for="node-input-nameLightDIM" style="width:100px;"><i class="fa fa-play-circle-o"></i>&nbspDimming</label>

        <label for="node-input-GALightDIM" style="width:20px;"><span data-i18n="knxUltimateHueLight.node-input-GALightState"></span></label>
        <input type="text" id="node-input-GALightDIM" placeholder="Ex: 1/1/1" style="width:70px;margin-left: 5px; text-align: left;">
        
        <label for="node-input-dptLightDIM" style="width:40px; margin-left: 0px; text-align: right;">DPT</label>
        <select id="node-input-dptLightDIM" style="width:140px;"></select>
        
        <label for="node-input-nameLightDIM" style="width:50px; margin-left: 0px; text-align: right;"><span data-i18n="knxUltimateHueLight.node-input-name"></span></label>
        <input type="text" id="node-input-nameLightDIM" style="width:200px;margin-left: 5px; text-align: left;">
        </div>
        <div class="form-row">
        <label for="node-input-nameLightBrightness" style="width:100px;"><i class="fa fa-play-circle-o"></i>&nbspBrightness</label>

        <label for="node-input-GALightBrightness" style="width:20px;"><span data-i18n="knxUltimateHueLight.node-input-GALightState"></span></label>
        <input type="text" id="node-input-GALightBrightness" placeholder="Ex: 1/1/1" style="width:70px;margin-left: 5px; text-align: left;">
        
        <label for="node-input-dptLightBrightness" style="width:40px; margin-left: 0px; text-align: right;">DPT</label>
        <select id="node-input-dptLightBrightness" style="width:140px;"></select>
        
        <label for="node-input-nameLightBrightness" style="width:50px; margin-left: 0px; text-align: right;"><span data-i18n="knxUltimateHueLight.node-input-name"></span></label>
        <input type="text" id="node-input-nameLightBrightness" style="width:200px;margin-left: 5px; text-align: left;">
        </div>
    
        <div class="form-row">
        <label for="node-input-nameLightBrightnessState" style="width:100px;"><i class="fa fa-play-circle-o"></i> Brightness Status</label>

        <label for="node-input-GALightBrightnessState" style="width:20px;"><span data-i18n="knxUltimateHueLight.node-input-GALightState"></span></label>
        <input type="text" id="node-input-GALightBrightnessState" placeholder="Ex: 1/1/1" style="width:70px;margin-left: 5px; text-align: left;">
        
        <label for="node-input-dptLightBrightnessState" style="width:40px; margin-left: 0px; text-align: right;">DPT</label>
        <select id="node-input-dptLightBrightnessState" style="width:140px;"></select>
        
        <label for="node-input-nameLightBrightnessState" style="width:50px; margin-left: 0px; text-align: right;"><span data-i18n="knxUltimateHueLight.node-input-name"></span></label>
        <input type="text" id="node-input-nameLightBrightnessState" style="width:200px;margin-left: 5px; text-align: left;">
        </div>
      </p>
    </div>
    <div id="tabs-3">
      <p>
        <div class="form-row">
            <label for="node-input-nameLightHSV" style="width:100px;"><i class="fa fa-play-circle-o"></i> Tunable white</label>
    
            <label for="node-input-GALightHSV" style="width:20px;"><span data-i18n="knxUltimateHueLight.node-input-GALightState"></span></label>
            <input type="text" id="node-input-GALightHSV" placeholder="Ex: 1/1/1" style="width:70px;margin-left: 5px; text-align: left;">
    
            <label for="node-input-dptLightHSV" style="width:40px; margin-left: 0px; text-align: right;">DPT</label>
            <select id="node-input-dptLightHSV" style="width:140px;"></select>
    
            <label for="node-input-nameLightHSV" style="width:50px; margin-left: 0px; text-align: right;"><span data-i18n="knxUltimateHueLight.node-input-name"></span></label>
            <input type="text" id="node-input-nameLightHSV" style="width:200px;margin-left: 5px; text-align: left;">
        </div>
        <div class="form-row">
            <label for="node-input-nameLightHSVState" style="width:100px;"><i class="fa fa-play-circle-o"></i> Tunable white Status</label>
    
            <label for="node-input-GALightHSVState" style="width:20px;"><span data-i18n="knxUltimateHueLight.node-input-GALightState"></span></label>
            <input type="text" id="node-input-GALightHSVState" placeholder="Ex: 1/1/1" style="width:70px;margin-left: 5px; text-align: left;">
    
            <label for="node-input-dptLightHSVState" style="width:40px; margin-left: 0px; text-align: right;">DPT</label>
            <select id="node-input-dptLightHSVState" style="width:140px;"></select>
    
            <label for="node-input-nameLightHSVState" style="width:50px; margin-left: 0px; text-align: right;"><span data-i18n="knxUltimateHueLight.node-input-name"></span></label>
            <input type="text" id="node-input-nameLightHSVState" style="width:200px;margin-left: 5px; text-align: left;">
        </div>
      </p>
    </div>
    <div id="tabs-4">
        <p>
            <div class="form-row">
            <label for="node-input-nameLightColor" style="width:100px;"><i class="fa fa-play-circle-o"></i>&nbspColor</label>
    
            <label for="node-input-GALightColor" style="width:20px;"><span data-i18n="knxUltimateHueLight.node-input-GALightState"></span></label>
            <input type="text" id="node-input-GALightColor" placeholder="Ex: 1/1/1" style="width:70px;margin-left: 5px; text-align: left;">
            
            <label for="node-input-dptLightColor" style="width:40px; margin-left: 0px; text-align: right;">DPT</label>
            <select id="node-input-dptLightColor" style="width:140px;"></select>
            
            <label for="node-input-nameLightColor" style="width:50px; margin-left: 0px; text-align: right;"><span data-i18n="knxUltimateHueLight.node-input-name"></span></label>
            <input type="text" id="node-input-nameLightColor" style="width:200px;margin-left: 5px; text-align: left;">
            </div>
            <div class="form-row">
            <label for="node-input-nameLightColorState" style="width:100px;"><i class="fa fa-play-circle-o"></i> Color Status</label>
    
            <label for="node-input-GALightColorState" style="width:20px;"><span data-i18n="knxUltimateHueLight.node-input-GALightState"></span></label>
            <input type="text" id="node-input-GALightColorState" placeholder="Ex: 1/1/1" style="width:70px;margin-left: 5px; text-align: left;">
            
            <label for="node-input-dptLightColorState" style="width:40px; margin-left: 0px; text-align: right;">DPT</label>
            <select id="node-input-dptLightColorState" style="width:140px;"></select>
            
            <label for="node-input-nameLightColorState" style="width:50px; margin-left: 0px; text-align: right;"><span data-i18n="knxUltimateHueLight.node-input-name"></span></label>
            <input type="text" id="node-input-nameLightColorState" style="width:200px;margin-left: 5px; text-align: left;">
            </div>
        </p>      
    </div>

    <div id="tabs-5">
        <p>
            <div class="form-row">
            <label for="node-input-nameLightBlink" style="width:100px;"><i class="fa fa-play-circle-o"></i> Blink</label>
    
            <label for="node-input-GALightBlink" style="width:20px;"><span data-i18n="knxUltimateHueLight.node-input-GALightState"></span></label>
            <input type="text" id="node-input-GALightBlink" placeholder="Ex: 1/1/1" style="width:70px;margin-left: 5px; text-align: left;">
            
            <label for="node-input-dptLightBlink" style="width:40px; margin-left: 0px; text-align: right;">DPT</label>
            <select id="node-input-dptLightBlink" style="width:140px;"></select>
            
            <label for="node-input-nameLightBlink" style="width:50px; margin-left: 0px; text-align: right;"><span data-i18n="knxUltimateHueLight.node-input-name"></span></label>
            <input type="text" id="node-input-nameLightBlink" style="width:200px;margin-left: 5px; text-align: left;">
                </div>
        
            <div class="form-row">
            <label for="node-input-nameLightColorCycle" style="width:100px;"><i class="fa fa-play-circle-o"></i> Color Cycle</label>
    
            <label for="node-input-GALightColorCycle" style="width:20px;">GA</label>
            <input type="text" id="node-input-GALightColorCycle" placeholder="Ex: 1/1/1" style="width:70px;margin-left: 5px; text-align: left;">
            
            <label for="node-input-dptLightColorCycle" style="width:40px; margin-left: 0px; text-align: right;">DPT</label>
            <select id="node-input-dptLightColorCycle" style="width:140px;"></select>
            
            <label for="node-input-nameLightColorCycle" style="width:50px; margin-left: 0px; text-align: right;"><span data-i18n="knxUltimateHueLight.node-input-name"></span></label>
            <input type="text" id="node-input-nameLightColorCycle" style="width:200px;margin-left: 5px; text-align: left;">
            </div>
        </p>      
    </div>
    
<br/>
</script>


<script type="text/markdown" data-help-name="knxUltimateHueLight">
<p>This node lets you control your Philips HUE light and also get the states of this lights, to be sent to the KNX bus.

**General**
|Property|Description|
|--|--|
| KNX GW | Select the KNX gateway to be used |
| HUE Bridge | Select the HUE Bridge to be used |
| Name | HUE light to be used. The avaiable lights start showing up while you're typing.|

<br/>

**OPTIONS**

Here you can choose the KNX addresses to be linked to the avaiable HUE light commands/states.<br/>
Start typing in the GA field, the name or group address of your KNX device, the avaiable devices start showing up while you're typing.

|Property|Description|
|--|--|
| Switch | This GA is used to turn on/off the HUE light via a boolean KNX value true/false|
| Switch Status| Link this to the light's switch status group address|
| Dimming | Relative DIM the HUE light |
| Color | This command is used to change the HUE light's color. Accepted datapoint is RGB triplet (r,g,b). The node handles the gamut color correction. As soon as you send a color KNX telegran, the light turns on and sets color and brightness, derived from the brightness human perception. As soon as you send a KNX telegram with r,g,b set to zero, the light turns off |
| Color Status | Link this to the light's color status group address. Accepted datapoint is RGB triplet (r,g,b)|
| Tunable white | This command is used to change the HUE light's white temperature. Datapoint is 3.007 dimming. |
| Tunable white Status | Link this to the light temperature status group address. Datapoint is 5.001 absolute value|
| Brightness | This command is used to change the absolute HUE light's brightness |
| Brightness Status| Link this to the light's brightness status group address |
| Blink| *true* Blink the light, *false* Stop blinking. Blinks the light on and off. Useful for signalling. Works with all HUE lights. |
| Color Cycle| *true* start cycle, *false* Stop cycle. Randomly changes the HUE light's color at regular interval. Works with all HUE lights having color capabilities. |
| Day/Night | *true* if daytime, *false* if nighttime. This GA is used to change some behaviours at day or night. |
| Switch on color at Daytime | You can choose the color/brightness of your light, at switch on, on night time. Set it as JSON object, like { "red": 255, "green": 255, "blue": 255 } |
| Switch on color at Nighttime | You can choose the color/brightness of your light, at switch on, on night time. Set it as JSON object, like { "red": 100, "green": 0, "blue": 0 } |
<br/>

[Find it useful?](https://www.paypal.me/techtoday)

<br/>
</script>